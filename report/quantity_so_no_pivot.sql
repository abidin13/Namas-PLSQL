SELECT  (SELECT NAME FROM HR_ALL_ORGANIZATION_UNITS WHERE ORGANIZATION_ID = A.ORG_ID) OU,
        MCBV.SEGMENT1 PRODUK,
          SUM(
            CASE
            WHEN B.SHIPPED_QUANTITY IS NULL THEN
                0
            ELSE B.SHIPPED_QUANTITY
            END
          ) QTY_KIRIM,
          SUM(
            CASE
            WHEN B.ORDERED_QUANTITY IS NULL THEN
                0
            ELSE B.ORDERED_QUANTITY
            END
          ) QTY_ORDER
          
FROM OE_ORDER_HEADERS_ALL A, OE_ORDER_LINES_ALL B, MTL_ITEM_CATEGORIES MICV, MTL_CATEGORIES_B_KFV MCBV
WHERE A.HEADER_ID = B.HEADER_ID
AND B.INVENTORY_ITEM_ID = MICV.INVENTORY_ITEM_ID
AND MICV.CATEGORY_ID = MCBV.CATEGORY_ID
AND MICV.ORGANIZATION_ID = 89
AND MICV.CATEGORY_SET_ID = '1100000050'
AND B.SHIPPING_INTERFACED_FLAG = 'Y'
--AND A.ORG_ID = :ORG_ID
AND (SELECT AA.INITIAL_PICKUP_DATE
        FROM WSH_NEW_DELIVERIES AA
        WHERE AA.DELIVERY_ID =
            (
            SELECT BB.DELIVERY_ID
            FROM WSH_DELIVERY_ASSIGNMENTS BB
            WHERE BB.DELIVERY_DETAIL_ID = (SELECT CC.DELIVERY_DETAIL_ID
                                            FROM WSH_DELIVERY_DETAILS CC
                                            WHERE CC.SOURCE_LINE_ID = B.LINE_ID
                                            AND CC.DELIVERY_DETAIL_ID  = (SELECT MAX(DD.DELIVERY_DETAIL_ID)
                                                FROM WSH_DELIVERY_DETAILS DD
                                                WHERE DD.SOURCE_LINE_ID = B.LINE_ID)
                                          )
            )
        ) BETWEEN TRUNC(TO_DATE (:TGL1, 'RRRR/MM/DD HH24:MI:SS'))
                    AND TRUNC(TO_DATE (:TGL2,'RRRR/MM/DD HH24:MI:SS')+1)
GROUP BY A.ORG_ID, MCBV.SEGMENT1
ORDER BY OU, PRODUK